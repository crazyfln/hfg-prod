{% extends 'base.html' %}
{% block title %}
Search | Home For Grandma 
{% endblock title %}
{% load static %}
{% block extra_head %}
<link href="{% static 'slider/css/slider.css' %}" rel="stylesheet">
{% endblock extra_head %}


{% block content %}
<div class="background-beige search-background">
  <div id='searchbox-and-results' class="container search-container-left padder-80">
    {% include 'snippets/searchbox.html' with form=form %}
    <div id="search-results ">
      {% for listing in object_list %}
        {% if forloop.counter0|divisibleby:"3" %}
          <div class="row">
        {% endif %}
        {% include 'snippets/listing_preview.html' with user=request.user facility=listing %}
        {% if forloop.counter|divisibleby:"3" or forloop.last %}
          </div>
        {% endif %}
      {% empty %}
          <center><h2 class='empty'>We are busy adding thousands of listing to our website. We’re sorry, your search didn’t return any of our currently listed communities. Our advisors can still help give us a call at 1(800) 434-0324.</h2></center>
      {% endfor %}
      {% if is_paginated %}
        <div class="pagination">
          <span class="page-links">
            {% if page_obj.has_previous %}
              <a href="?page={{ page_obj.previous_page_number }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}" class="pagination-link">
                <button class="button-blue">PREVIOUS</button>
              </a>
            {% endif %}
            <span class="page-current">
              Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
            </span>
            {% if page_obj.has_next %}
              <a href="?page={{ page_obj.next_page_number }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}" class="pagination-link">
                <button class="button-blue">NEXT</button>
              </a>
            {% endif %}
          </span>
        </div>
      {% endif %}
    </div>
  </div>

  <div id='map-canvas' class='fadeInRight'>

  </div>
</div>

{% endblock content %}
{% block main_footer %}
{% endblock main_footer %}
{% block body_media %}

  <script type="text/javascript"
    src="https://maps.googleapis.com/maps/api/js?key={{ settings.GOOGLE_MAPS_API_KEY }}"></script>
  <script>
    min_val = $('#id_min_value').attr('value');
    if (min_val == undefined){
      min_val = {{ real_min_val }};
    }
    max_val = $('#id_max_value').attr('value');
    if (max_val == undefined){
      max_val = {{ real_max_val }};
    }

    google.maps.event.addDomListener(window, 'load', init);
    function init() {

    results = [
      {% for result in object_list %}
      [{{ result.latitude }},{{ result.longitude }}, "{{ result.name }}", "{{ result.slug }}"],
      {% endfor %}
    ];

    var mapOptions = {
      zoom: 5,
      {% if object_list %}
      center: new google.maps.LatLng(results[0][0], results[0][1]),
      {% else %}
      center: new google.maps.LatLng(53.385873, -1.471471),
      {% endif %}
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      styles: [{"featureType":"water","stylers":[{"saturation":43},{"lightness":-11},{"hue":"#0088ff"}]},{"featureType":"road","elementType":"geometry.fill","stylers":[{"hue":"#ff0000"},{"saturation":-100},{"lightness":99}]},{"featureType":"road","elementType":"geometry.stroke","stylers":[{"color":"#808080"},{"lightness":54}]},{"featureType":"landscape.man_made","elementType":"geometry.fill","stylers":[{"color":"#ece2d9"}]},{"featureType":"poi.park","elementType":"geometry.fill","stylers":[{"color":"#ccdca1"}]},{"featureType":"road","elementType":"labels.text.fill","stylers":[{"color":"#767676"}]},{"featureType":"road","elementType":"labels.text.stroke","stylers":[{"color":"#ffffff"}]},{"featureType":"poi","stylers":[{"visibility":"off"}]},{"featureType":"landscape.natural","elementType":"geometry.fill","stylers":[{"visibility":"on"},{"color":"#b8cb93"}]},{"featureType":"poi.park","stylers":[{"visibility":"on"}]},{"featureType":"poi.sports_complex","stylers":[{"visibility":"on"}]},{"featureType":"poi.medical","stylers":[{"visibility":"on"}]},{"featureType":"poi.business","stylers":[{"visibility":"simplified"}]}]
    };
    

    var mapElement = document.getElementById('map-canvas');
    var map = new google.maps.Map(mapElement, mapOptions);

    var infowindow = new google.maps.InfoWindow();

    var marker, i;

    for (i = 0; i < results.length; i++) {  
      marker = new google.maps.Marker({
        position: new google.maps.LatLng(results[i][0], results[i][1]),
        map: map
      });
      google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          map.panTo(marker.getPosition());
          infowindow.open(map, marker);
          matchingResult = $("#" + results[i][3])
          $('.container').animate({
              scrollTop: matchingResult.offset().top
          }, 500);
          matchingResult.addClass('glow-result')
          setTimeout(function () { 
            matchingResult.removeClass('glow-result');
          }, 500);
        }
      })(marker, i));
    }
    $('.listing-preview').hover(function() {
      $(this).delay(500).queue(function(){
        var latLong = new google.maps.LatLng(parseFloat($(this).data('lat')), parseFloat($(this).data('long')))
        map.panTo(latLong);
      });
    },function() {
      $(this).finish();
    });

    $('#myonoffswitch').change(function() {
      var map = $('#map-canvas')
      var searchbox = $('#searchbox-and-results')
      var background = $('.background-beige')
      if( $(this).is(':checked') ){
        map.show()
        searchbox.addClass('search-container-left')
        background.addClass('search-background')
      }
      else {
        map.hide();
        searchbox.removeClass('search-container-left')
        background.removeClass('search-background')
      }
    });
}

</script>
{% endblock body_media %}
